# Custom Data Types (CDT)

Custom data types in Welkin are associated with a Patient. In REST terms, they are a sub-resource to the patient object

Each CDT has a set of system fields associated with it and a set of custom fields that you will create in the designer

## System Fields

Field Name | Type | Description
--------- | ----------- | --------
id | UUID | Unique autogenerated identifier
updated_by | UUID |UUID of user or client who updated the record
updated_by_name | String | Full name of the user or api client that updated the record
updated_at | Date_time in [ISO-8601](https://en.wikipedia.org/wiki/ISO_8601) format | Date and time of the last update to the record
created_by | UUID | UUID of user or client who created the record
created_by_name | String | Full name of the user or api client that created the record
created_at| Date_time in [ISO-8601](https://en.wikipedia.org/wiki/ISO_8601) format | Date and time when the record was created
source_type | String | Source type of the record (for example: ASSESSMENT if assessment type  generated this record)
source_name | String | Name of the source type (for example: my_medication_assessment if assessment type  generated this record)
source_id | UUID | record ID of the source

## Working with CDT records

Lets examine the URL structure

`https://api.live.welkincloud.io/{tenant}/{instance}/patients/{patient-id}/cdts/{cdt-name}/{cdt-record-id}`


Let's consider the following example.
CDT that was created in the designer is **vitals** with three fields
1. blood_sugar
2. systolic
3. diastolic

In our example the collection URL is
`https://api.live.welkincloud.io/gh/sb-demo/patients/6801d498-26f4-4aee-961b-5daffcf193c8/cdt/vitals`

This collection is collection of records for a vitals cdt object, associated with a specific patient as described by the patient id

## Create CDT Record

```python
import requests
h = {
        "Authorization": "Bearer {}".format(token)
}

data = {
    "blood_sugar": random.randint(90, 300),
    "diastolic": random.randint(90, 220),
    "systolic": random.randint(60, 140),
}

r = requests.post("https://api.live.welkincloud.io/gh/sb-demo/patients/a02a0310-5fca-4af8-aa87-c14d6b4d5723/cdt/vitals", 
  json=data, headers=h)

print("Response Code: {}".format(r.status_code))
print(r.json())
```
> The above request returns JSON of the created record, with system fields

```json

{
  "id": "e46bfff7-62c9-407b-a0a1-5d522aeab9d0",
  "patientId": "a02a0310-5fca-4af8-aa87-c14d6b4d5723",
  "cdtId": "11f9d7c0-5065-433e-937e-8abfee98ff31",
  "version": 5,
  "jsonBody": {
    "created_at": "2021-03-22T06:40:08.482Z",
    "source_type": None,
    "created_by_name": "API_CLIENT:VBOPNRYRWJIP",
    "created_by": "16d7a4ff-cce4-4c9c-bcc9-74d1b00b72bf",
    "updated_by_name": "API_CLIENT:VBOPNRYRWJIP",
    "diastolic": 174,
    "systolic": 100,
    "updated_at": "2021-03-22T06:40:08.482Z",
    "updated_by": "16d7a4ff-cce4-4c9c-bcc9-74d1b00b72bf",
    "id": "e46bfff7-62c9-407b-a0a1-5d522aeab9d0",
    "source_id": None,
    "blood_sugar": 196,
    "source_name": None
  }
}
```
1. HTTP Method: POST
2. HTTP URL: `https://api.live.welkincloud.io/gh/sb-demo/patients/a02a0310-5fca-4af8-aa87-c14d6b4d5723/cdt/vitals`
3. HTTP Reponse Codes: 201, 400, 500


## Reading CDT Record

```python
import requests
h = {
        "Authorization": "Bearer {}".format(token)
}


r = requests.get("https://api.live.welkincloud.io/gh/sb-demo/patients/a02a0310-5fca-4af8-aa87-c14d6b4d5723/cdt/vitals/11f9d7c0-5065-433e-937e-8abfee98ff31", headers=h)

print("Response Code: {}".format(r.status_code))
print(r.json())
```
> The above request returns JSON of the created record, with system fields

```json

{
  "id": "e46bfff7-62c9-407b-a0a1-5d522aeab9d0",
  "patientId": "a02a0310-5fca-4af8-aa87-c14d6b4d5723",
  "cdtId": "11f9d7c0-5065-433e-937e-8abfee98ff31",
  "version": 5,
  "jsonBody": {
    "created_at": "2021-03-22T06:40:08.482Z",
    "source_type": None,
    "created_by_name": "API_CLIENT:VBOPNRYRWJIP",
    "created_by": "16d7a4ff-cce4-4c9c-bcc9-74d1b00b72bf",
    "updated_by_name": "API_CLIENT:VBOPNRYRWJIP",
    "diastolic": 174,
    "systolic": 100,
    "updated_at": "2021-03-22T06:40:08.482Z",
    "updated_by": "16d7a4ff-cce4-4c9c-bcc9-74d1b00b72bf",
    "id": "e46bfff7-62c9-407b-a0a1-5d522aeab9d0",
    "source_id": None,
    "blood_sugar": 196,
    "source_name": None
  }
}
```
1. HTTP Method: GET
2. HTTP URL: `https://api.live.welkincloud.io/gh/sb-demo/patients/a02a0310-5fca-4af8-aa87-c14d6b4d5723/cdt/vitals/11f9d7c0-5065-433e-937e-8abfee98ff31`
3. HTTP Reponse Codes: 200, 400, 500


## Updating CDT Record

```python
import requests
h = {
    "Authorization": "Bearer {}".format(token)
}

data = {
    "blood_sugar": "200",
}

r = requests.patch("https://api.live.welkincloud.io/gh/sb-demo/patients/a02a0310-5fca-4af8-aa87-c14d6b4d5723/cdt/vitals", 
  json=data, headers=h)

print("Response Code: {}".format(r.status_code))
print(r.json())
```
> The above request returns JSON of the record, with system fields

```json

{
  "id": "e46bfff7-62c9-407b-a0a1-5d522aeab9d0",
  "patientId": "a02a0310-5fca-4af8-aa87-c14d6b4d5723",
  "cdtId": "11f9d7c0-5065-433e-937e-8abfee98ff31",
  "version": 5,
  "jsonBody": {
    "created_at": "2021-03-22T06:40:08.482Z",
    "source_type": None,
    "created_by_name": "API_CLIENT:VBOPNRYRWJIP",
    "created_by": "16d7a4ff-cce4-4c9c-bcc9-74d1b00b72bf",
    "updated_by_name": "API_CLIENT:VBOPNRYRWJIP",
    "diastolic": 165,
    "systolic": 128,
    "updated_at": "2021-03-22T06:50:37.739Z",
    "updated_by": "16d7a4ff-cce4-4c9c-bcc9-74d1b00b72bf",
    "id": "e46bfff7-62c9-407b-a0a1-5d522aeab9d0",
    "source_id": None,
    "blood_sugar": 200,
    "source_name": None
  }
}
```

All updates are partial updates, meaning that we will update only the fields you will send to the server

1. HTTP Method: PATCH
2. HTTP URL: `https://api.live.welkincloud.io/gh/sb-demo/patients/a02a0310-5fca-4af8-aa87-c14d6b4d5723/cdt/vitals/11f9d7c0-5065-433e-937e-8abfee98ff31`
3. HTTP Reponse Codes: 200, 400, 500

## Find CDT records

Use finder parameters to filter output of the collection for a given patient

1. HTTP Method: GET
2. HTTP URL: `https://api.live.welkincloud.io/gh/sb-demo/patients/a02a0310-5fca-4af8-aa87-c14d6b4d5723/cdt/vitals`

Parameters| Format | Description
--------- | ----------- | --------
fields | <list fields> | fields=name,phone
page | page number Integer |UUID of user or client who updated the record
size | page size Integer
filters | key=v1,v2,v3
dateStart | Date_time in [ISO-8601](https://en.wikipedia.org/wiki/ISO_8601) format | dateStart=2021-01-28T23:10:04.874Z
dateEnd |Date_time in [ISO-8601](https://en.wikipedia.org/wiki/ISO_8601) format | dateEnd=2021-01-28T23:10:04.874Z
